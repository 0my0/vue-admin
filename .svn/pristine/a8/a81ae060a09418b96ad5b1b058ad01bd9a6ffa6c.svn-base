{"remainingRequest":"E:\\vueProject\\admin\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\vueProject\\admin\\vue-element-admin\\src\\views\\sales\\first-hand\\coupon-manager\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\vueProject\\admin\\vue-element-admin\\src\\views\\sales\\first-hand\\coupon-manager\\index.vue","mtime":1576832207857},{"path":"E:\\vueProject\\admin\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\vueProject\\admin\\vue-element-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\vueProject\\admin\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\vueProject\\admin\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport SystemManager from  '@/api/system-manager'\nimport Sales from '@/api/sales'\nimport { getToken} from  '@/utils/auth'\nimport toJsonData from '@/api/jsonformdata'\nexport default {\n  name: 'coupon-manager',\n  data(){\n    return{\n      formInline: {\n        site_id: '',\n        game_id:''\n      },\n      formLabelWidth:'120px',\n      siteData: [],\n      gameData: [],\n      sequence: 1,\n      tableData: [],\n      couponForm: {\n        site_id: '',\n        game_ids: [],\n        title: '',\n        code: '',\n        price:'',\n        stime:'',\n        ltime:'',\n        num:'',\n        coupon_type:''\n      },\n      gameIds:[],\n      checked:false,\n      dialogFormVisible: false,\n      dialogAddFormVisible:false,\n      dialogPersonFormVisible: false,\n      dialogPermissionVisible:false,\n      couponType: ['一次性优惠券', '多次优惠券'],\n      isCouponHidden: true,\n      token: getToken(),\n      pickerOptionsStart: {\n        disabledDate:time => {\n          const endDateVal = new Date(this.couponForm.ltime).getTime()\n          if (endDateVal) {\n            return time.getTime() > endDateVal - 0\n          }\n          return  time.getTime() < Date.now()-8.64e7;\n        }\n      },\n      pickerOptionsEnd: {\n        disabledDate: time => {\n          const beginDateVal = new Date(this.couponForm.stime).getTime()\n          if (beginDateVal) {\n            return time.getTime() < beginDateVal - 0\n          }\n        }\n      }\n    }\n  },\n  methods: {\n    getSiteIndex() {\n      SystemManager.getSiteIndex(this.token).then(data => {\n        this.siteData=data.data\n      })\n    },\n    showDialog() {\n      this.dialogFormVisible = true;\n      this.couponForm= {\n        site_id: '',\n          game_ids: [],\n          title: '',\n          code: '',\n          price:'',\n          stime:'',\n          ltime:'',\n          num:'',\n          coupon_type:'多次优惠券'\n      }\n    },\n    handleCheckAllChange(val) {\n      this.couponForm.game_ids = [];\n      if(val == true){\n        this.gameData.forEach(item => {\n          this.couponForm.game_ids.push(item.game_id)\n        })\n      }else{\n        this.couponForm.game_ids = [];\n      }\n    },\n    getGameIndex() {\n      this.gameIds = [];\n      SystemManager.getGameIndex(this.token).then(data => {\n        this.gameData=data.data\n      })\n    },\n    onSubmit() {\n      Sales.searchCoupon(this.formInline.site_id, this.formInline.game_id,this.token).then(data=>{\n        this.tableData=data.data\n      })\n    },\n\n    addCoupon(){\n      const postData = toJsonData.JsonData(this.couponForm);\n      Sales.addCoupon(postData, this.token).then(data=> {\n        this.$message({\n          message: data.data.log,\n          type: 'success'\n        })\n        this.getCouponIndex();\n        this.closeDialog();\n      }).catch(error => {\n        console.log(error)\n      })\n    },\n    closeDialog() {\n      this.dialogFormVisible = false;\n    },\n    deleteCoupon(coupon_id) {\n      Sales.deleteCoupon(coupon_id, this.token).then(data => {\n        this.$message({\n          message: data.data.log,\n          type: 'success'\n        })\n        this.getCouponIndex();\n      }).catch(error => {\n        console.log(error)\n      })\n\n    },\n    changeCoupon() {\n      this.formInline.game_id='';\n      Sales.changeCoupon(this.formInline.site_id, this.token).then(data => {\n        this.gameData=data.data\n      })\n    },\n    addChangeCoupon() {\n      this.couponForm.game_id='';\n      this.checked = false;\n      this.couponForm.game_ids = [];\n      Sales.changeCoupon(this.couponForm.site_id, this.token).then(data => {\n        this.gameData=data.data\n      })\n    },\n    changeCouponType(val){\n     this.couponForm.code='';\n      this.couponForm.stime='';\n      this.couponForm.ltime='';\n      this.couponForm.num='';\n      if(val == '一次性优惠券'){\n        this.isCouponHidden = false\n      }else{\n        this.isCouponHidden = true\n      }\n    },\n    getCouponIndex() {\n      Sales.getCouponIndex(this.token).then(data=> {\n        this.tableData = data.data;\n      })\n    }\n  },\n  created() {\n    this.getSiteIndex();\n    this.getGameIndex();\n    this.getCouponIndex();\n    this.couponForm.coupon_type = this.couponType[1];\n  },\n}\n",null]}